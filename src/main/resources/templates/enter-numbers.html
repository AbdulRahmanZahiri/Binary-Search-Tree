<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Binary Search Tree Generator</title>
    <style>
        * { box-sizing: border-box; }
        body {
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Arial, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh; margin: 0;
          display: flex; align-items: center; justify-content: center; padding: 24px;
        }
        .container {
          width: 100%; max-width: 980px; background: #fff; color:#111827;
          border-radius: 20px; padding: 28px; box-shadow: 0 10px 30px rgba(0,0,0,.15);
        }
        h1 {
          font-weight: 700; margin: 6px 0 14px; letter-spacing: .2px;
          background: linear-gradient(90deg,#111827,#4f46e5); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .note {
          background: #eaf2ff; border: 1px solid #cfe1ff; color: #1f3b7b;
          border-radius: 12px; padding: 14px 16px; margin-bottom: 18px;
        }
        .row { display:flex; gap:14px; flex-wrap:wrap; align-items:center; }
        .input {
          flex:1 1 420px; display:flex; gap:10px; align-items:center;
          background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px;
        }
        .input input[type="text"]{
          width:100%; font-size:16px; background:transparent; border:none; outline:none; color:#111827;
        }
        .checkbox {
          display:flex; align-items:center; gap:8px; user-select:none;
          padding:8px 10px; border-radius:10px; background:#f9fafb; border:1px solid #e5e7eb;
        }
        .btn {
          appearance:none; border:none; cursor:pointer; font-weight:600;
          padding:12px 18px; border-radius:12px; transition:.2s transform, .2s box-shadow, .2s background;
        }
        .btn-primary { background:#7c3aed; color:#fff; box-shadow:0 6px 14px rgba(124,58,237,.35); }
        .btn-primary:hover { transform: translateY(-1px); box-shadow:0 10px 20px rgba(124,58,237,.35); }
        .btn-secondary { background:#eef2ff; color:#4338ca; }
        .actions{ display:flex; gap:12px; flex-wrap:wrap; }

        .panel {
          margin-top: 22px; background:#f8fafc; border:1px solid #e5e7eb; border-radius:14px; padding:18px;
        }
        .panel h3 { margin:0 0 10px; font-size:18px; }
        .success, .error {
          padding:10px 12px; border-radius:10px; font-weight:600; margin-bottom:12px; display:inline-block;
        }
        .success { background:#ecfdf5; border:1px solid #a7f3d0; color:#065f46; }
        .error { background:#fef2f2; border:1px solid #fecaca; color:#991b1b; }
        pre {
          margin:0; padding:14px; background:#0b1220; color:#e5e7eb; border-radius:12px; overflow:auto;
        }
        .grid { display:grid; gap:14px; grid-template-columns: 1fr 1fr; }
        @media (max-width: 860px) { .grid { grid-template-columns: 1fr; } }
        .meta { display:flex; gap:14px; flex-wrap:wrap; }
        .pill{ background:#eef2ff; color:#1f2937; border:1px solid #e5e7eb; padding:8px 10px; border-radius:999px; }
    </style>
</head>
<body>
<div class="container">
    <h1>Binary Search Tree Generator</h1>
    <div class="note">
        <strong>Instructions:</strong> Enter a series of numbers separated by commas (e.g., <em>5,3,7,2,4,6,8</em>).
        The application will create a binary search tree and display the results.
    </div>

    <form id="numberForm" class="row" autocomplete="off">
        <div class="input" style="flex:1">
            <input id="numbers" type="text" placeholder="7,3,9,1,5" />
        </div>
        <label class="checkbox">
            <input id="balanced" type="checkbox" />
            <span>Create Balanced BST (Bonus Feature)</span>
        </label>
        <div class="actions">
            <button class="btn btn-primary" type="submit">Generate Tree</button>
            <button class="btn btn-secondary" type="button" id="showPrevBtn">Show Previous Trees</button>
        </div>
    </form>

    <div id="resultContainer" class="panel">
        <h3>Tree Result</h3>
        <div id="resultContent"></div>

        <div class="grid">
            <div>
                <h3>Tree Structure (JSON)</h3>
                <div id="treeVisualization"><pre>// Generated JSON will appear here</pre></div>
            </div>
            <div>
                <h3>Info</h3>
                <div id="treeInfo" class="meta">
                    <span class="pill">No data yet</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // navigate to history
    document.getElementById('showPrevBtn').addEventListener('click', () => {
      window.location.href = '/previous-trees';
    });

    // helper msgs
    function showError(msg){
      document.getElementById('resultContent').innerHTML = '<span class="error">'+msg+'</span>';
    }
    function showSuccess(msg){
      document.getElementById('resultContent').innerHTML = '<span class="success">'+msg+'</span>';
    }

    // pretty-print JSON tree + info
    function displayResult(result){
      const treeVisualization = document.getElementById('treeVisualization');
      const treeInfo = document.getElementById('treeInfo');

      showSuccess('Tree generated successfully!');
      const jsonPretty = JSON.stringify(result.tree, null, 2);
      treeVisualization.innerHTML = '<pre>'+jsonPretty+'</pre>';

      const balanced = (typeof result.balanced !== 'undefined') ? result.balanced : result.isBalanced;
      const count = Array.isArray(result.inputNumbers) ? result.inputNumbers.length : 'n/a';

      treeInfo.innerHTML = '';
      const pills = [
        ['Balanced', String(!!balanced)],
        ['Input Count', String(count)]
      ];
      pills.forEach(([k,v])=>{
        const span = document.createElement('span');
        span.className = 'pill';
        span.textContent = k+': '+v;
        treeInfo.appendChild(span);
      });
    }

    // submit -> call JSON API
    document.getElementById('numberForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const raw = document.getElementById('numbers').value.trim();
      const balanced = document.getElementById('balanced').checked;

      if (!raw) return showError('Please enter some numbers');

      const numbers = raw.split(/[\s,]+/).filter(Boolean).map(n => Number(n));
      if (numbers.length === 0 || numbers.some(n => Number.isNaN(n))) {
        return showError('Please enter valid integers separated by commas');
      }

      try {
        const resp = await fetch('/api/process-numbers', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ numbers, balanced })
        });
        if (!resp.ok) throw new Error('Failed ('+resp.status+'): ' + await resp.text());
        const result = await resp.json();
        displayResult(result);
      } catch (err) {
        showError('Error processing numbers: ' + err.message);
        document.getElementById('treeVisualization').innerHTML = '<pre>// no data</pre>';
        document.getElementById('treeInfo').innerHTML = '<span class="pill">No data</span>';
      }
    });
</script>
</body>
</html>
